<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analisis Saham</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>


    
    <div class="container mt-5">
	<!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="#">Stock Analysis <span id='tanggal'></span></a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item active">
                    <a class="nav-link" href="index.html">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="analysis.html">Analysis</a>
                </li>
            </ul>
        </div>
    </nav>
        <!--<h2 class="text-center">Analisis Perubahan Harga Saham </h2>-->

        <!-- Input Kode Saham -->
        <!--
	    <div class="mb-3">
            <label for="kodeSaham" class="form-label">Code</label>
            <input type="text" class="form-control" oninput="this.value = this.value.toUpperCase()" id="kodeSaham" />
        </div>
	    -->
	<div class="mb-3">
            <label for="kodeSaham" class="form-label">Choose Stock Code</label>
            <select id="kodeSaham" class="form-select">
                <!-- Options will be dynamically added here -->
            </select>
        </div>

        <!-- Button for Triggering Action -->
        <button id="cekSaham" class="btn btn-primary">Go</button>

        <!-- Result Output -->
        <div id="hasil" class="mt-4">
            <!-- Hasil akan ditampilkan di sini -->
        </div>

        <!-- Progress Bar -->
        <div class="mt-4">
            <h4>Power</h4>
            <div class="progress">
                <div id="progressBar" class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                    0%
                </div>
            </div>
        </div>

        <!-- Last Price, Description, Target Profit, and Cut Loss -->
        <div id="targetInfo" class="mt-4">
            <!-- Info will be displayed here -->
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        $(document).ready(function () {
		const tickers = [
    'AALI.JK', 'ABBA.JK', 'ABDA.JK', 'ABMM.JK', 'ACES.JK', 'ACST.JK', 'ADES.JK', 'ADHI.JK', 'ADMF.JK', 'ADMG.JK', 
    'ADRO.JK', 'AGII.JK', 'AGRO.JK', 'AGRS.JK', 'AHAP.JK', 'AIMS.JK', 'AISA.JK', 'AKKU.JK', 'AKPI.JK', 'AKRA.JK', 
    'AKSI.JK', 'ALDO.JK', 'ALKA.JK', 'ALMI.JK', 'ALTO.JK', 'AMAG.JK', 'AMFG.JK', 'AMIN.JK', 'AMRT.JK', 'ANJT.JK', 
    'ANTM.JK', 'APEX.JK', 'APIC.JK', 'APII.JK', 'APLI.JK', 'APLN.JK', 'ARGO.JK', 'ARII.JK', 'ARNA.JK', 'ARTA.JK', 
    'ARTI.JK', 'ARTO.JK', 'ASBI.JK', 'ASDM.JK', 'ASGR.JK', 'ASII.JK', 'ASJT.JK', 'ASMI.JK', 'ASRI.JK', 'ASRM.JK', 
    'ASSA.JK', 'ATIC.JK', 'AUTO.JK', 'BABP.JK', 'BACA.JK', 'BAJA.JK', 'BALI.JK', 'BAPA.JK', 'BATA.JK', 'BAYU.JK', 
    'BBCA.JK', 'BBHI.JK', 'BBKP.JK', 'BCAP.JK', 'BCIC.JK', 'BCIP.JK', 'BDMN.JK', 'BEKS.JK', 'BEST.JK', 'BFIN.JK', 
    'BGTG.JK', 'BHIT.JK', 'BIKA.JK', 'BIMA.JK', 'BINA.JK', 'BIPI.JK', 'BIPP.JK', 'BIRD.JK', 'BISI.JK', 'BJBR.JK', 
    'BJTM.JK', 'BKDP.JK', 'BKSL.JK', 'BKSW.JK', 'BLTA.JK', 'BLTZ.JK', 'BMAS.JK', 'BMRI.JK', 'BMSR.JK', 'BMTR.JK', 
    'BNBA.JK', 'BNBR.JK', 'BNGA.JK', 'BNII.JK', 'BNLI.JK', 'BOLT.JK', 'BPFI.JK', 'BPII.JK', 'BRAM.JK', 'BRMS.JK', 
    'BRNA.JK', 'BRPT.JK', 'BSDE.JK', 'BSIM.JK', 'BSSR.JK', 'BSWD.JK', 'BTEK.JK', 'BTEL.JK', 'BTON.JK', 'BTPN.JK', 
    'BUDI.JK', 'BUKK.JK', 'BULL.JK', 'BUMI.JK', 'BUVA.JK', 'BVIC.JK', 'BWPT.JK', 'BYAN.JK', 'CANI.JK', 'CASS.JK', 
    'CEKA.JK', 'CENT.JK', 'CFIN.JK', 'CINT.JK', 'CITA.JK', 'CLPI.JK', 'CMNP.JK', 'CMPP.JK', 'CNKO.JK', 'CNTX.JK', 
    'COWL.JK', 'CPIN.JK', 'CPRO.JK', 'CSAP.JK', 'CTBN.JK', 'CTRA.JK', 'CTTH.JK', 'DART.JK', 'DEFI.JK', 'DEWA.JK', 
    'DGIK.JK', 'DILD.JK', 'DKFT.JK', 'DLTA.JK', 'DMAS.JK', 'DNAR.JK', 'DNET.JK', 'DOID.JK', 'DPNS.JK', 'DSFI.JK', 
    'DSNG.JK', 'DSSA.JK', 'DUTI.JK', 'DVLA.JK', 'DYAN.JK', 'ECII.JK', 'EKAD.JK', 'ELSA.JK', 'ELTY.JK', 'EMDE.JK', 
    'EMTK.JK', 'ENRG.JK', 'EPMT.JK', 'ERAA.JK', 'ERTX.JK', 'ESSA.JK', 'ESTI.JK', 'ETWA.JK', 'EXCL.JK', 'FAST.JK', 
    'FASW.JK', 'FISH.JK', 'FMII.JK', 'FORU.JK', 'FPNI.JK', 'GAMA.JK', 'GDST.JK', 'GDYR.JK', 'GEMA.JK', 'GEMS.JK', 
    'GGRM.JK', 'GIAA.JK', 'GJTL.JK', 'GLOB.JK', 'GMTD.JK', 'GOLD.JK', 'GOLL.JK', 'GPRA.JK', 'GSMF.JK', 'GTBO.JK', 
    'GWSA.JK', 'GZCO.JK', 'HADE.JK', 'HDFA.JK', 'HDTX.JK', 'HERO.JK', 'HEXA.JK', 'HITS.JK', 'HMSP.JK', 'HOME.JK', 
    'HOTL.JK', 'HRUM.JK', 'IATA.JK', 'IBFN.JK', 'IBST.JK', 'ICBP.JK', 'ICON.JK', 'IGAR.JK', 'IIKP.JK', 'IKAI.JK', 
    'IKBI.JK', 'IMAS.JK', 'IMJS.JK', 'IMPC.JK', 'INAF.JK', 'INAI.JK', 'INCI.JK', 'INCO.JK', 'INDF.JK', 'INDR.JK', 
    'INDS.JK', 'INDX.JK', 'INDY.JK', 'INKP.JK', 'INPC.JK', 'INPP.JK', 'INRU.JK', 'INTA.JK', 'INTD.JK', 'INTP.JK', 
    'IPOL.JK', 'ISAT.JK', 'ISSP.JK', 'ITMA.JK', 'ITMG.JK', 'JAWA.JK', 'JECC.JK', 'JIHD.JK', 'JKON.JK', 'JKSW.JK', 
    'JPFA.JK', 'JRPT.JK', 'JSMR.JK', 'JSPT.JK', 'JTPE.JK', 'KAEF.JK', 'KARW.JK', 'KBLI.JK', 'KBLM.JK', 'KBLV.JK', 
    'KBRI.JK', 'KDSI.JK', 'KIAS.JK', 'KICI.JK', 'KIJA.JK', 'KKGI.JK', 'KLBF.JK', 'KOBX.JK', 'KOIN.JK', 'KONI.JK', 
    'KOPI.JK', 'KPIG.JK', 'KRAH.JK', 'KRAS.JK', 'KREN.JK', 'LAPD.JK', 'LCGP.JK', 'LEAD.JK', 'LINK.JK', 'LION.JK', 
    'LMAS.JK', 'LMPI.JK', 'LMSH.JK', 'LPCK.JK', 'LPGI.JK', 'LPIN.JK', 'LPKR.JK', 'LPLI.JK', 'LPPF.JK', 'LPPS.JK', 
    'LRNA.JK', 'LSIP.JK', 'LTLS.JK', 'MAGP.JK', 'MAIN.JK', 'MAMI.JK', 'MAPI.JK', 'MASA.JK', 'MAYA.JK', 'MBAP.JK', 
    'MBSS.JK', 'MBTO.JK', 'MCOR.JK', 'MDIA.JK', 'MDKA.JK', 'MDLN.JK', 'MDRN.JK', 'MEDC.JK', 'MEGA.JK', 'MERK.JK', 
    'META.JK', 'MFIN.JK', 'MFMI.JK', 'MGNA.JK', 'MICE.JK', 'MIDI.JK', 'MIKA.JK', 'MIRA.JK', 'MITI.JK', 'MKPI.JK', 
    'MLBI.JK', 'MLIA.JK', 'MLPL.JK', 'MLPT.JK', 'MMLP.JK', 'MNCN.JK', 'MPMX.JK', 'MPPA.JK', 'MRAT.JK', 'MREI.JK'
];
            var sahamData = [];  // Variable for storing data from JSON
			///
			let currentDate = new Date();
			// Format tanggal menjadi YYYY-MM-DD
			let formattedDate = currentDate.getFullYear() +
                    ("0" + (currentDate.getMonth() + 1)).slice(-2) +
                    ("0" + currentDate.getDate()).slice(-2);
			let tanggal=("0" + currentDate.getDate()).slice(-2)+"-"+("0" + (currentDate.getMonth() + 1)).slice(-2)+"-"+currentDate.getFullYear();
		$('#tanggal').html(tanggal);
			// Menambahkan string ".json"
			let fileName = "https://soweon.com/json/"+formattedDate + ".json";
			//console.log(fileName);
			///
            // Handle file upload event
            $.getJSON(fileName, function(data) {
                sahamData = data;  // Store the data in the sahamData variable
                console.log(sahamData);  // For debugging purposes
            }).fail(function() {
                alert('Failed to load the JSON file.');
            });
		 // Populate the select options with tickers
            tickers.forEach(function (ticker) {
                $('#kodeSaham').append(new Option(ticker, ticker));
            });
            // Event listener for checking stock prediction when button is clicked
            $('#cekSaham').click(function () {
                processStockAnalysis();
            });

            // Event listener for checking stock prediction when Enter is pressed
            $('#kodeSaham').keypress(function (e) {
                if (e.which == 13) {  // Enter key is pressed
                    processStockAnalysis();
                }
            });

            // Function to process the stock analysis
            function processStockAnalysis() {
                var kodeSaham = $('#kodeSaham').val().trim() + '.JK';  // Get stock code from input and append '.JK'
                
                if (kodeSaham === "") {
                    $('#hasil').html('<div class="alert alert-danger">Stock code cannot be empty!</div>');
                    return;
                }

                // Find stock data based on stock code
                var saham = sahamData.find(item => item.Ticker === kodeSaham);

                if (saham) {
                    var analysisResults = [];
                    var naikCount = 0;
                    var totalIndicators = 0;

                    // Evaluate each indicator
                    for (const [indicator, value] of Object.entries(saham)) {
                        if (indicator !== 'Ticker' && indicator !== 'Last Price' &&  indicator !== 'Power Up') {
                            totalIndicators++;
                            if (value === 'Naik') {
                                naikCount++;
                                analysisResults.push('Naik');
                            } else if (value === 'Turun') {
                                analysisResults.push('Turun');
                            } else {
                                analysisResults.push('Netral');
                            }
                        }
                    }

                    // Calculate majority analysis result
                    var prediksi = "NETRAL";
                    if (naikCount > totalIndicators / 2) {
                        prediksi = "NAIK";
                    } else if (naikCount < totalIndicators / 2) {
                        prediksi = "TURUN";
                    }

                    // Display analysis result
                    $('#hasil').html(`<div class="alert alert-info">Predicted stock ${kodeSaham}:<b>  ${prediksi}</b></div>`);

                    // Fetch Progress Percentage from the "Perse" field in JSON
                    var percent = saham['Power Up'];  // Assuming "Perse" field in JSON represents the progress percentage
                    $('#progressBar').css('width', percent + '%').attr('aria-valuenow', percent).text(percent.toFixed(0) + '%');

                    // Change progress bar color based on the value of "Perse"
                    if (percent > 40 && percent <70) {
                        $('#progressBar').removeClass('bg-danger').addClass('bg-warning');
						
                    }
					else if (percent >= 70 ) {
                        $('#progressBar').removeClass('bg-danger').addClass('bg-success');
						
                    }
					else {
                        $('#progressBar').removeClass('bg-success').addClass('bg-danger');
                    }

                    // Fetch Last Price and Description from JSON data
                    var lastPrice = saham['Last Price'].toFixed(0);  // Get the Last Price from the JSON
                    //var description = saham['Deskripsi'];  // Get the Description from the JSON
                    
                    // Assuming the last price and description are available
                    var targetProfit = (lastPrice * 1.1).toFixed(0);  // Target profit (10% increase)
                    var cutLoss = (lastPrice * 0.9).toFixed(0);  // Cut loss (10% decrease)
					var max_pot_in =saham['Max Potential Increase'];
					var max_pot_dec =saham['Max Potential Decrease'];
					
					

                    $('#targetInfo').html(`
                        <div class="alert alert-info">
                            <strong>Last Price:</strong> ${lastPrice}<br>
                            <strong>Potensi Kenaikan Max:</strong> ${max_pot_in}<br>
							<strong>Potensi Penurunan Max:</strong> ${max_pot_dec}<br>
                            <strong>Target Profit (10%):</strong> ${targetProfit}<br>
                            <strong>Cut Loss (10%):</strong> ${cutLoss}
                        </div>
                    `);
					$('#kodeSaham').val("");

                } else {
                    $('#hasil').html('<div class="alert alert-warning">Data for this stock code not found.</div>');
                    $('#progressBar').css('width', '0%').text('0%').removeClass('bg-success').addClass('bg-danger');
                    $('#targetInfo').html('');  // Clear target info if stock not found
                }
            }
        });
    </script>
</body>
</html>
